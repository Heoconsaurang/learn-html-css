;/*FB_PKG_DELIM*/

__d("LSOptimisticSendAttachmentShareForward",["LSAppendDataTraceAddon","LSInsertOptimisticAttachment","LSIssueNewTaskAndGetTaskID","LSLocalApplyOptimisticMessage","LSPredefineTraceForTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(e){return c.sp(b("LSLocalApplyOptimisticMessage"),a[0],a[1],a[2],a[3],a[4],a[5],f,f,f,f,c.i64.cast([0,3]),f,f,f,!0).then(function(a){return a=a,d[0]=a[0],d[1]=a[1],a})},function(e){return c.sp(b("LSInsertOptimisticAttachment"),a[1],d[1],d[0],d[0],a[6],c.i64.cast([0,2]),f,f,!0,!1)},function(e){return c.sp(b("LSIssueNewTaskAndGetTaskID"),c.i64.to_string(a[1]),c.i64.cast([0,46]),"",f,f,c.i64.cast([0,0]),c.i64.cast([0,0]),c.i64.cast([0,1]),f,c.i64.cast([0,0])).then(function(a){return a=a,d[2]=a[0],a})},function(e){return f!==f?c.seq([function(a){return c.sp(b("LSPredefineTraceForTask"),f,d[2],c.i64.to_string(c.i64.cast([0,46])),d[0])},function(e){return d[8]=c.i64.to_string(a[7]),d[8]!==f?d[6]=d[8]:d[6]=c.i64.to_string(c.i64.cast([0,0])),d[7]=",",c.sp(b("LSAppendDataTraceAddon"),f,c.i64.cast([0,20]),c.i64.cast([0,1]),f,[d[6],d[7],c.i64.to_string(c.i64.cast([0,4])),d[7],c.i64.to_string(a[2])].join(""))}]):c.resolve()},function(b){return f?d[3]=!1:d[3]=!0,d[3]?(b=[f,f],d[4]=b[0],d[5]=b[1],b):(d[6]=f.get("share_treatment_type"),f,d[7]=f.get("share_treatment_name"),f,b=[d[6],d[7]],d[4]=b[0],d[5]=b[1],b),c.db.table(31).add({taskId:d[2],threadKey:a[1],offlineThreadingId:d[0],threadAttributionSource:a[7],sendType:c.i64.cast([0,4]),markThreadRead:!1,initiatingSource:a[8]})},function(a){return e[0]=d[0]}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSOptimisticSendURLShare",["LSInsertOptimisticAttachment","LSIssueNewTaskAndGetTaskID","LSLocalApplyOptimisticMessage"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(e){return c.sp(b("LSLocalApplyOptimisticMessage"),a[0],a[1],a[2],a[3],a[4],a[5],f,f,f,f,f,f,f,f,!1).then(function(a){return a=a,d[0]=a[0],d[1]=a[1],a})},function(e){return c.sp(b("LSInsertOptimisticAttachment"),a[1],d[1],d[0],d[0],d[0],c.i64.cast([0,7]),a[6],f,!1,!0)},function(e){return c.sp(b("LSIssueNewTaskAndGetTaskID"),c.i64.to_string(a[1]),c.i64.cast([0,46]),"",f,f,c.i64.cast([0,0]),c.i64.cast([0,0]),c.i64.cast([0,1]),f,c.i64.cast([0,0])).then(function(a){return a=a,d[2]=a[0],a})},function(b){return c.db.table(31).add({taskId:d[2],threadKey:a[1],offlineThreadingId:d[0],threadAttributionSource:a[7],sendType:c.i64.cast([0,6]),markThreadRead:!1,initiatingSource:a[8]})},function(a){return e[0]=d[0]}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSShareAttachment",["I64","InteractionTracingMetrics","LSDatabaseSingleton","LSFactory","LSIntEnum","LSMessagingInitiatingSource","LSOptimisticSendAttachmentShareForward","LSOptimisticSendURLShare","LSThreadAttributionTypeUtil.bs","MWChatInteraction.bs","MWQPLMarkers","asyncToGeneratorRuntime","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a,e){var f=function(a){e!=null&&c("InteractionTracingMetrics").addMarkerPoint(e,a,"AppTiming")};function g(a){e!=null&&d("MWChatInteraction.bs").set(d("MWChatInteraction.bs").s2sKey(a),e)}c("promiseDone")(c("LSDatabaseSingleton").then(function(e){var h,i=d("I64").of_string(a.actorID),j=d("I64").of_string(a.targetID),k=a.shareID,l=(h=a.message)!=null?h:"",m=a.targetType==="group"?d("LSIntEnum").ofNumber(2):d("LSIntEnum").ofNumber(1),n=d("LSThreadAttributionTypeUtil.bs").getSource(j,a.entryPoint);f(d("MWQPLMarkers").MESSAGE_SEND_TO_SENT.BEFORE_CREATE_OPTIMISTIC_MESSAGE);return e.runInTransaction(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){if(a.url!=null){var e=(yield c("LSOptimisticSendURLShare")(i,j,m,l,void 0,!1,a.url,n,d("LSIntEnum").ofNumber(c("LSMessagingInitiatingSource").FACEBOOK_CHAT),c("LSFactory")(b)));g(e[0]);f(d("MWQPLMarkers").MESSAGE_SEND_TO_SENT.CREATE_OPTIMISTIC_MESSAGE_SUCCESS);return e}e=(yield c("LSOptimisticSendAttachmentShareForward")(i,j,m,l,void 0,!1,k,n,d("LSIntEnum").ofNumber(c("LSMessagingInitiatingSource").FACEBOOK_CHAT),c("LSFactory")(b)));g(e[0]);f(d("MWQPLMarkers").MESSAGE_SEND_TO_SENT.CREATE_OPTIMISTIC_MESSAGE_SUCCESS);return e});return function(a){return e.apply(this,arguments)}}(),"readwrite")}))}g.share=a}),98);